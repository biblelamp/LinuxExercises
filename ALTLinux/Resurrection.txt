Записки майнтейнера: resurrection

В 2010 я стал майнтейнером в ALT Linux: провёл пробную сборку пакета под руководством ментора @damir, получил свой ник, gpg ключи и доступ в Сизиф (sisyphus.ru). Почти год (с апреля 2010 по январь 2011) я старательно сопровождал пакет basic256 (http://sisyphus.ru/ru/srpm/Sisyphus/basic256) и выпустил 7 сборок. Затем на первый план вышли более актуальные задачи и я забросил свои обязанности. Теперь же решил "вернуться". Связался с ребятами из ALT, получил предварительное добро, заручился поддержкой нового ментора (@qa_glebfm) и приступил к делу.

1. Моё новое старое железо

К сожалению, старичок eMachines M6810, специально купленный для работы c ALT Linux в марте 2010 за 6 тыс. руб, давно отдал концы. Благо в моём хозяйстве обнаружился Samsung P28 (Celeron 1.5Ghz) c 512Mb RAM, без HDD и БП, доставшийся по случаю совершенно бесплатно. Докупил к нему БП и поставил 60Gb хард (c почившего eMachines). Установил Simply Linux 7.0.5 - и рабочая лошадка готова. Да, ещё приобрёл с хорошей скидкой (150 руб) USB WiFi TP-LINK TL-WN723N, поскольку в моём Samsung модуля WiFi не оказалось.

2. Переход к 8й ветке

Первое, что мне посоветовал ментор - обновиться до ветки p8. Что я и проделал, с некоторыми приключениями, которые вряд ли стоят особого внимания. Посетил страницу https://www.altlinux.org/Update и выполнил следующую серию команд:

$ sudo apt-repo rm all
$ sudo apt-repo add p8
$ sudo apt-get update
$ sudo apt-get dist-upgrade
$ sudo update-kernel

Перезагрузился и - вуаля, у меня свеженькая версия:

$ cat /etc/altlinux-release
Simply Linux 7.95.0 (Dory)

В качестве бонуса - заработал мой USB WiFi TP-LINK.

3. Восстановление доступа

Ключевой вопрос - что с моими ключами? Понятно, они были на eMachines, но тот хард в своё время был переформатирован. Однако тогда, по совету своего первого ментора @damir я сохранил две папки (.gnupg и .ssh) на другом диске.

Сначала разберёмся с файлами ключей (из моей старой папки .gnupg). Выполняю команду:

$ gpg —with-fingerprint secring.gpg

и показываю ментору (в telegram) результат. Это нужно чтобы сравнить fingerprint ключа, который у меня, с тем, который есть в keyring-е ключей членов Team. Отпечаток совпадает. Да, это мои ключи.

Испортирую:

$ gpg --import pubring.gpg
$ gpg --import secring.gpg
$ rm *.gpg

Самое время вспомнить пароль. Создаю пустой файл и пытаюсь его подписать:

$ touch test_file
$ gpg -ab test_file

в ответ gpg запрашивает у меня фразу-пароль. Да, это уже серьёзная проблема. Какой пароль я мог использовать в далёком 2010? Делаю несколько попыток, результат один: Неверная фраза-пароль; попробуйте ещё раз... "Забыть пароль - всё равно что утратить ключи", - тем временем пишет мне ментор. И тут меня словно осеняет! Пробую свою догадку - срабатывает. Файл подписан и я вспомнил свой пароль!

Займёмся папкой .ssh - копирую туда ключи (из моей старой .ssh):

$ ssh-add id_dsa
$ cp id_dsa .ssh
$ cp id_dsa.pub .ssh
$ rm id_dsa*

и создаю там также файл (vim ~/.ssh/config) со следующим содержимым:

Host git.alt
    HostName gitery.altlinux.org
    Port 222
    User git_lamp

Host gyle.alt
    HostName gyle.altlinux.org
    Port 222
    User git_lamp

Добавляем в ~/.ssh/config первой строкой:

PubkeyAcceptedKeyTypes +ssh-dss

Проверяю доступ командой:

$ ssh git.alt help
Enter passphrase for key '/home/lamp/.ssh/id_dsa':

Ввожу пароль тот же, что и для gpg ключа - и получаю список доступных команд.
Доступ восстановлен. Я снова в ALT Linux Team.